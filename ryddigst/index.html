<!DOCTYPE html>
<html lang="no">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ryddigst.no - Presisjonsvisning</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --apple-bg: #ffffff;
            --apple-gray: #f5f5f7;
            --apple-text: #1d1d1f;
            --apple-secondary: #86868b;
            --accent: #0071e3;
            --drawer-wood: #d1d1d1;
            --drawer-inside: #e5e5e5;
            
            /* Akryl-effekt */
            --acrylic-surface: linear-gradient(135deg, rgba(255, 255, 255, 0.9) 0%, rgba(240, 245, 255, 0.6) 100%);
            --acrylic-edge: rgba(0, 0, 0, 0.08);
            --acrylic-highlight: rgba(255, 255, 255, 0.8);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', sans-serif; background-color: var(--apple-bg); color: var(--apple-text); -webkit-font-smoothing: antialiased; }

        header { background: rgba(255,255,255,0.8); backdrop-filter: blur(20px); border-bottom: 1px solid rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 100; }
        .nav-container { max-width: 1100px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; height: 70px; padding: 0 20px; }
        .logo-link img { height: 50px; width: auto; display: block; object-fit: contain; }

        main { max-width: 1100px; margin: 40px auto; padding: 0 20px; }

        /* HERO / CALC BOX */
        .calc-box { background: var(--apple-gray); border-radius: 30px; padding: 30px; margin-bottom: 40px; text-align: center; }
        .input-group { display: flex; gap: 20px; justify-content: center; align-items: flex-end; flex-wrap: wrap; }
        .input-item { display: flex; flex-direction: column; text-align: left; }
        .input-item label { font-size: 11px; font-weight: 700; color: var(--apple-secondary); margin-bottom: 5px; text-transform: uppercase; }
        .input-item input { padding: 12px; border-radius: 10px; border: 1px solid #d2d2d7; width: 100px; font-size: 16px; text-align: center; }

        /* RESULTS */
        .results-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; }
        @media (max-width: 850px) { .results-grid { grid-template-columns: 1fr; } }

        .card { background: white; border-radius: 28px; padding: 30px; border: 1px solid rgba(0,0,0,0.05); box-shadow: 0 10px 40px rgba(0,0,0,0.04); display: flex; flex-direction: column; }
        .card h3 { font-size: 20px; font-weight: 600; margin-bottom: 10px; }
        .card .subtitle { font-size: 13px; color: var(--apple-secondary); margin-bottom: 20px; }

        /* VISUALIZER */
        .visualizer-area {
            background: #f0f0f2;
            padding: 40px;
            border-radius: 18px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 350px;
            margin-bottom: 25px;
        }
        .drawer-outline {
            position: relative;
            background: #ffffff;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.05), 0 20px 50px rgba(0,0,0,0.15);
            border: 6px solid #333;
            border-radius: 4px;
        }
        .box-item {
            position: absolute;
            background: var(--acrylic-surface);
            border: 1px solid var(--acrylic-edge);
            border-radius: 3px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 700;
            color: rgba(0,0,0,0.4);
            box-shadow: 1px 2px 4px rgba(0,0,0,0.08), inset 0 0 0 1px var(--acrylic-highlight);
            backdrop-filter: blur(5px);
            box-sizing: border-box;
        }

        /* BILLING / LIST */
        .list-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; font-size: 14px; }
        .list-table th { text-align: left; color: var(--apple-secondary); padding-bottom: 10px; border-bottom: 1px solid #eee; font-weight: 500; }
        .list-table td { padding: 12px 0; border-bottom: 1px solid #f9f9f9; }
        .text-right { text-align: right; }

        .upsell-box {
            background: var(--apple-gray);
            padding: 15px;
            border-radius: 14px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 13px;
        }

        .total-row { display: flex; justify-content: space-between; align-items: baseline; padding-top: 15px; border-top: 1px solid #eee; }
        .grand-total { font-size: 26px; font-weight: 700; }

        .btn { background: var(--apple-text); color: white; border: none; width: 100%; padding: 16px; border-radius: 14px; font-weight: 600; font-size: 15px; margin-top: 20px; cursor: pointer; transition: all 0.2s; }
        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn-update { background: var(--accent); width: auto; margin-top: 0; padding: 12px 25px; }

        .efficiency-badge { font-size: 11px; font-weight: 700; color: var(--accent); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 5px; display: block; }
    </style>
</head>
<body>

<header>
    <div class="nav-container">
        <a href="#" class="logo-link">
            <img src="pnglogo.png" alt="ryddigst.no" onerror="this.outerHTML='<span style=\'font-weight:700; font-size:24px\'>Ryddigst.no</span>'">
        </a>
    </div>
</header>

<main>
    <div class="calc-box">
        <div class="input-group">
            <div class="input-item"><label>Bredde (cm)</label><input type="number" id="drawerW" value="61"></div>
            <div class="input-item"><label>Dybde (cm)</label><input type="number" id="drawerD" value="50"></div>
            <button class="btn btn-update" onclick="runCalculation()">Oppdater beregning</button>
        </div>
    </div>

    <div class="results-grid" id="output">
        </div>
</main>

<script>
    const products = [
        { sku: 10, w: 20, d: 30, p: 249, n: 'Premium XL' },
        { sku: 9, w: 13, d: 15, p: 109, n: 'Premium Volum' },
        { sku: 8, w: 12, d: 15, p: 99, n: 'Premium Anker' },
        { sku: 6, w: 12, d: 13, p: 89, n: 'Premium Justering' },
        { sku: 5, w: 11, d: 15, p: 89, n: 'Premium Spesial' },
        { sku: 7, w: 11, d: 12, p: 79, n: 'Premium Spesial' },
        { sku: 4, w: 10, d: 15, p: 79, n: 'Premium Bestselger' },
        { sku: 3, w: 10, d: 14, p: 85, n: 'Premium Spesial' },
        { sku: 2, w: 10, d: 13, p: 79, n: 'Premium Justering' },
        { sku: 1, w: 10, d: 10, p: 59, n: 'Premium Anker' }
    ];

    async function runCalculation() {
        const W = parseInt(document.getElementById('drawerW').value);
        const D = parseInt(document.getElementById('drawerD').value);
        const out = document.getElementById('output');
        if (!W || !D) return;

        out.innerHTML = '<div style="grid-column: 1/-1; text-align:center; padding: 50px;">Optimaliserer din skuff...</div>';
        await new Promise(r => setTimeout(r, 100));

        // Alt 1: Effektivitet
        let l1 = solve(W, D, [...products].sort((a,b) => (b.w*b.d)-(a.w*a.d)), 1200);
        // Alt 2: Variasjon
        let l2 = null; let maxScore = -1;
        for(let i=0; i<15; i++) {
            let res = solve(W, D, [...products].sort(() => Math.random()-0.5), 300);
            let score = (res.coverage === 100 ? 5000 : res.coverage) + res.items.length;
            if(score > maxScore) { maxScore = score; l2 = res; }
        }

        out.innerHTML = '';
        renderCard('Alternativ 1: Minimalistisk', 'Færrest mulig bokser for et rent uttrykk.', l1, W, D, out, 1);
        renderCard('Alternativ 2: Maks organisering', 'Maksimal inndeling for perfekt sortering.', l2, W, D, out, 2);
    }

    function solve(W, D, inventory, timeLimit) {
        let grid = new Int8Array(W * D).fill(0);
        let placed = [];
        let best = { items: [], coverage: 0 };
        let startTime = Date.now();

        function backtrack(startIndex) {
            if (Date.now() - startTime > timeLimit) return false;
            let idx = -1;
            for (let i = startIndex; i < W * D; i++) { if (grid[i] === 0) { idx = i; break; } }
            if (idx === -1) { best = { items: [...placed], coverage: 100 }; return true; }

            for (let item of inventory) {
                const shapes = [{w: item.w, d: item.d}, {w: item.d, d: item.w}];
                for (let s of shapes) {
                    let x = idx % W, y = Math.floor(idx / W);
                    if (x + s.w <= W && y + s.d <= D) {
                        let overlap = false;
                        for (let ry = 0; ry < s.d; ry++) {
                            for (let rx = 0; rx < s.w; rx++) { if (grid[(y+ry)*W+(x+rx)]===1) { overlap=true; break; } }
                            if (overlap) break;
                        }
                        if (!overlap) {
                            // Gap-Detection Pruning
                            if (W - (x+s.w) > 0 && W - (x+s.w) < 10) continue;
                            
                            for (let ry = 0; ry < s.d; ry++) {
                                for (let rx = 0; rx < s.w; rx++) grid[(y+ry)*W+(x+rx)] = 1;
                            }
                            placed.push({...item, x, y, actW: s.w, actD: s.d});
                            if (backtrack(idx + 1)) return true;
                            placed.pop();
                            for (let ry = 0; ry < s.d; ry++) {
                                for (let rx = 0; rx < s.w; rx++) grid[(y+ry)*W+(x+rx)] = 0;
                            }
                        }
                    }
                    if (item.w === item.d) break;
                }
            }
            let cur = (placed.reduce((acc, i) => acc + (i.actW * i.actD), 0) / (W * D)) * 100;
            if (cur > best.coverage) best = { items: [...placed], coverage: cur };
            return false;
        }
        backtrack(0);
        return best;
    }

    function renderCard(title, sub, data, W, D, container, id) {
        const scale = Math.min(270 / W, 270 / D);
        let itemsMap = {}; let subtotal = 0;
        data.items.forEach(i => {
            if(!itemsMap[i.sku]) itemsMap[i.sku] = { n: i.n, p: i.p, qty: 0 };
            itemsMap[i.sku].qty++; subtotal += i.p;
        });

        const rows = Object.values(itemsMap).map(i => `
            <tr><td>${i.qty}x</td><td>${i.n}</td><td class="text-right">${i.p * i.qty},-</td></tr>
        `).join('');

        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
            <span class="efficiency-badge">${data.coverage.toFixed(0)}% Utnyttelse</span>
            <h3>${title}</h3>
            <p class="subtitle">${sub}</p>
            <div class="visualizer-area">
                <div class="drawer-outline" style="width: ${W*scale}px; height: ${D*scale}px;">
                    ${data.items.map(i => `
                        <div class="box-item" style="left:${i.x*scale}px; top:${i.y*scale}px; width:${i.actW*scale}px; height:${i.actD*scale}px">
                            ${i.actW}x${i.actD}
                        </div>
                    `).join('')}
                </div>
            </div>
            <table class="list-table">
                <thead><tr><th>Ant</th><th>Produkt</th><th class="text-right">Sum</th></tr></thead>
                <tbody>${rows}</tbody>
            </table>
            <div class="upsell-box">
                <label style="display:flex; align-items:center; gap:8px; cursor:pointer">
                    <input type="checkbox" onchange="upd(${subtotal}, ${id}, this)"> Legg til Merkelapper
                </label>
                <strong>79,-</strong>
            </div>
            <div class="total-row">
                <span style="font-weight:500; color:var(--apple-secondary)">Totalpris</span>
                <span class="grand-total" id="t-${id}">${subtotal},-</span>
            </div>
            <button class="btn" onclick="this.innerText='Lagt i kurv ✅'">Legg i handlekurv</button>
        `;
        container.appendChild(card);
    }

    function upd(base, id, cb) {
        document.getElementById(`t-${id}`).innerText = (base + (cb.checked ? 79 : 0)) + ',-';
    }

    window.onload = runCalculation;
</script>
</body>
</html>
